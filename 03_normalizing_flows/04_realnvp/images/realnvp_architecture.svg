<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 450">
  <defs>
    <linearGradient id="nvpArchBg" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#0c0c0c;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1a1a1a;stop-opacity:1" />
    </linearGradient>
    <marker id="nvpArrow" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#64748b"/>
    </marker>
  </defs>
  
  <rect width="900" height="450" fill="url(#nvpArchBg)"/>
  
  <text x="450" y="35" fill="#fff" font-family="Georgia, serif" font-size="20" text-anchor="middle" font-weight="bold">
    RealNVP Multi-Scale Architecture
  </text>
  
  <!-- Input -->
  <g transform="translate(80, 220)">
    <rect x="-50" y="-70" width="100" height="140" rx="8" fill="#1e293b" stroke="#ef4444" stroke-width="2"/>
    <text y="-45" fill="#ef4444" font-family="Georgia, serif" font-size="10" text-anchor="middle" font-weight="bold">INPUT</text>
    <rect x="-30" y="-35" width="60" height="60" rx="4" fill="#ef4444" opacity="0.4"/>
    <text y="45" fill="#94a3b8" font-family="monospace" font-size="9" text-anchor="middle">32×32×3</text>
  </g>
  
  <!-- Arrow -->
  <path d="M 135,220 L 175,220" stroke="#64748b" stroke-width="2" marker-end="url(#nvpArrow)"/>
  
  <!-- Squeeze -->
  <g transform="translate(220, 220)">
    <rect x="-35" y="-50" width="70" height="100" rx="8" fill="#21262d" stroke="#f97316" stroke-width="2"/>
    <text y="-30" fill="#f97316" font-family="Georgia, serif" font-size="9" text-anchor="middle" font-weight="bold">SQUEEZE</text>
    <text y="0" fill="#94a3b8" font-family="monospace" font-size="8" text-anchor="middle">H×W×C</text>
    <text y="15" fill="#94a3b8" font-family="monospace" font-size="8" text-anchor="middle">↓</text>
    <text y="30" fill="#94a3b8" font-family="monospace" font-size="8" text-anchor="middle">H/2×W/2</text>
    <text y="45" fill="#94a3b8" font-family="monospace" font-size="8" text-anchor="middle">×4C</text>
  </g>
  
  <!-- Arrow -->
  <path d="M 260,220 L 300,220" stroke="#64748b" stroke-width="2" marker-end="url(#nvpArrow)"/>
  
  <!-- Coupling Layers Block 1 -->
  <g transform="translate(380, 220)">
    <rect x="-70" y="-80" width="140" height="160" rx="8" fill="#1e293b" stroke="#eab308" stroke-width="2"/>
    <text y="-55" fill="#eab308" font-family="Georgia, serif" font-size="10" text-anchor="middle" font-weight="bold">K COUPLING</text>
    <text y="-40" fill="#eab308" font-family="Georgia, serif" font-size="10" text-anchor="middle" font-weight="bold">LAYERS</text>
    
    <!-- Stacked coupling visualization -->
    <rect x="-50" y="-25" width="100" height="20" rx="3" fill="#eab308" opacity="0.3"/>
    <rect x="-45" y="-10" width="90" height="20" rx="3" fill="#eab308" opacity="0.4"/>
    <rect x="-40" y="5" width="80" height="20" rx="3" fill="#eab308" opacity="0.5"/>
    <rect x="-35" y="20" width="70" height="20" rx="3" fill="#eab308" opacity="0.6"/>
    
    <text y="60" fill="#64748b" font-family="monospace" font-size="8" text-anchor="middle">alternate masks</text>
  </g>
  
  <!-- Arrow -->
  <path d="M 455,220 L 495,220" stroke="#64748b" stroke-width="2" marker-end="url(#nvpArrow)"/>
  
  <!-- Split -->
  <g transform="translate(540, 220)">
    <rect x="-35" y="-50" width="70" height="100" rx="8" fill="#21262d" stroke="#22d3ee" stroke-width="2"/>
    <text y="-30" fill="#22d3ee" font-family="Georgia, serif" font-size="9" text-anchor="middle" font-weight="bold">SPLIT</text>
    <text y="-5" fill="#94a3b8" font-family="monospace" font-size="8" text-anchor="middle">½ → z</text>
    <text y="10" fill="#94a3b8" font-family="monospace" font-size="8" text-anchor="middle">½ → next</text>
  </g>
  
  <!-- Arrow to latent -->
  <path d="M 540,165 L 540,100 L 750,100" stroke="#22d3ee" stroke-width="2" fill="none" stroke-dasharray="5,3"/>
  <text x="650" y="90" fill="#22d3ee" font-family="Georgia, serif" font-size="9" text-anchor="middle">to latent z</text>
  
  <!-- Arrow to next scale -->
  <path d="M 580,220 L 620,220" stroke="#64748b" stroke-width="2" marker-end="url(#nvpArrow)"/>
  
  <!-- Next scale (repeated) -->
  <g transform="translate(700, 220)">
    <rect x="-60" y="-60" width="120" height="120" rx="8" fill="#1e293b" stroke="#8b5cf6" stroke-width="2"/>
    <text y="-35" fill="#8b5cf6" font-family="Georgia, serif" font-size="9" text-anchor="middle" font-weight="bold">SCALE 2</text>
    <text y="-15" fill="#64748b" font-family="Georgia, serif" font-size="8" text-anchor="middle">Squeeze</text>
    <text y="0" fill="#64748b" font-family="Georgia, serif" font-size="8" text-anchor="middle">↓</text>
    <text y="15" fill="#64748b" font-family="Georgia, serif" font-size="8" text-anchor="middle">K Coupling</text>
    <text y="30" fill="#64748b" font-family="Georgia, serif" font-size="8" text-anchor="middle">↓</text>
    <text y="45" fill="#64748b" font-family="Georgia, serif" font-size="8" text-anchor="middle">Split/Output</text>
  </g>
  
  <!-- Final latent -->
  <g transform="translate(850, 220)">
    <circle cx="0" cy="0" r="35" fill="#22d3ee" opacity="0.2"/>
    <circle cx="0" cy="0" r="22" fill="#22d3ee" opacity="0.4"/>
    <circle cx="0" cy="0" r="10" fill="#22d3ee"/>
    <text y="55" fill="#22d3ee" font-family="Georgia, serif" font-size="10" text-anchor="middle" font-weight="bold">z ~ N(0,I)</text>
  </g>
  
  <path d="M 765,220 L 805,220" stroke="#64748b" stroke-width="2" marker-end="url(#nvpArrow)"/>
  
  <!-- Legend at bottom -->
  <g transform="translate(450, 400)">
    <rect x="-350" y="-25" width="700" height="50" rx="8" fill="#1e293b" stroke="#475569"/>
    <text y="0" fill="#e2e8f0" font-family="Georgia, serif" font-size="12" text-anchor="middle">
      Affine Coupling: yᵦ = zᵦ ⊙ exp(s(zₐ)) + t(zₐ)  |  Log-det: Σᵢ s(zₐ)ᵢ  |  Loss: -log p(z) - Σ log|det J|
    </text>
  </g>
</svg>


