<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1100 450">
  <defs>
    <linearGradient id="bgDSM" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#0a0a18"/>
      <stop offset="100%" style="stop-color:#16213e"/>
    </linearGradient>
    
    <linearGradient id="titleDSM" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#43e97b"/>
      <stop offset="50%" style="stop-color:#38f9d7"/>
      <stop offset="100%" style="stop-color:#00d9ff"/>
    </linearGradient>
    
    <linearGradient id="dataGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#667eea"/>
      <stop offset="100%" style="stop-color:#764ba2"/>
    </linearGradient>
    
    <linearGradient id="noiseGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#f5576c"/>
      <stop offset="100%" style="stop-color:#f093fb"/>
    </linearGradient>
    
    <linearGradient id="networkGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#00d9ff"/>
      <stop offset="100%" style="stop-color:#667eea"/>
    </linearGradient>
    
    <linearGradient id="lossGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#43e97b"/>
      <stop offset="100%" style="stop-color:#38f9d7"/>
    </linearGradient>
    
    <filter id="glowDSM">
      <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    
    <marker id="arrowFlow" markerWidth="12" markerHeight="8" refX="10" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#feca57"/>
    </marker>
  </defs>
  
  <rect width="1100" height="450" fill="url(#bgDSM)"/>
  
  <!-- Title -->
  <text x="550" y="40" text-anchor="middle" font-family="Georgia, serif" font-size="26" font-weight="700" fill="url(#titleDSM)" filter="url(#glowDSM)">
    Denoising Score Matching: Training Pipeline
  </text>
  
  <!-- Step 1: Clean Data -->
  <g transform="translate(100, 220)">
    <rect x="-60" y="-80" width="120" height="160" rx="12" fill="rgba(102,126,234,0.15)" stroke="url(#dataGrad)" stroke-width="2"/>
    
    <text x="0" y="-55" text-anchor="middle" font-family="system-ui" font-size="11" font-weight="600" fill="#667eea">STEP 1</text>
    <text x="0" y="-38" text-anchor="middle" font-family="system-ui" font-size="10" fill="rgba(255,255,255,0.6)">Sample Data</text>
    
    <!-- Image placeholder -->
    <rect x="-35" y="-25" width="70" height="70" rx="6" fill="rgba(102,126,234,0.3)" stroke="#667eea" stroke-width="1"/>
    <text x="0" y="10" text-anchor="middle" font-family="system-ui" font-size="22" fill="white">üñºÔ∏è</text>
    
    <text x="0" y="65" text-anchor="middle" font-family="Georgia, serif" font-size="14" fill="white">x ~ p<tspan baseline-shift="sub" font-size="10">data</tspan></text>
  </g>
  
  <!-- Arrow 1 -->
  <line x1="175" y1="220" x2="235" y2="220" stroke="#feca57" stroke-width="2" marker-end="url(#arrowFlow)"/>
  
  <!-- Step 2: Add Noise -->
  <g transform="translate(310, 220)">
    <rect x="-60" y="-80" width="120" height="160" rx="12" fill="rgba(245,87,108,0.15)" stroke="url(#noiseGrad)" stroke-width="2"/>
    
    <text x="0" y="-55" text-anchor="middle" font-family="system-ui" font-size="11" font-weight="600" fill="#f5576c">STEP 2</text>
    <text x="0" y="-38" text-anchor="middle" font-family="system-ui" font-size="10" fill="rgba(255,255,255,0.6)">Add Noise</text>
    
    <!-- Noisy image -->
    <rect x="-35" y="-25" width="70" height="70" rx="6" fill="rgba(245,87,108,0.3)" stroke="#f5576c" stroke-width="1"/>
    <text x="0" y="10" text-anchor="middle" font-family="system-ui" font-size="18" fill="white">üñºÔ∏è+üìä</text>
    
    <text x="0" y="60" text-anchor="middle" font-family="Georgia, serif" font-size="12" fill="white">xÃÉ = x + œÉŒµ</text>
    <text x="0" y="75" text-anchor="middle" font-family="system-ui" font-size="9" fill="rgba(255,255,255,0.5)">Œµ ~ N(0, I)</text>
  </g>
  
  <!-- Arrow 2 -->
  <line x1="385" y1="220" x2="445" y2="220" stroke="#feca57" stroke-width="2" marker-end="url(#arrowFlow)"/>
  
  <!-- Step 3: Neural Network -->
  <g transform="translate(545, 220)">
    <rect x="-80" y="-80" width="160" height="160" rx="12" fill="rgba(0,217,255,0.15)" stroke="url(#networkGrad)" stroke-width="2"/>
    
    <text x="0" y="-55" text-anchor="middle" font-family="system-ui" font-size="11" font-weight="600" fill="#00d9ff">STEP 3</text>
    <text x="0" y="-38" text-anchor="middle" font-family="system-ui" font-size="10" fill="rgba(255,255,255,0.6)">Score Network</text>
    
    <!-- Network visualization -->
    <g transform="translate(0, 15)">
      <circle cx="-40" cy="-20" r="8" fill="#00d9ff" opacity="0.6"/>
      <circle cx="-40" cy="0" r="8" fill="#00d9ff" opacity="0.6"/>
      <circle cx="-40" cy="20" r="8" fill="#00d9ff" opacity="0.6"/>
      
      <circle cx="0" cy="-25" r="6" fill="#667eea" opacity="0.6"/>
      <circle cx="0" cy="-5" r="6" fill="#667eea" opacity="0.6"/>
      <circle cx="0" cy="15" r="6" fill="#667eea" opacity="0.6"/>
      <circle cx="0" cy="35" r="6" fill="#667eea" opacity="0.6"/>
      
      <circle cx="40" cy="-20" r="8" fill="#43e97b" opacity="0.6"/>
      <circle cx="40" cy="0" r="8" fill="#43e97b" opacity="0.6"/>
      <circle cx="40" cy="20" r="8" fill="#43e97b" opacity="0.6"/>
      
      <!-- Connections -->
      <g stroke="rgba(255,255,255,0.2)" stroke-width="1">
        <line x1="-32" y1="-20" x2="-6" y2="-25"/>
        <line x1="-32" y1="-20" x2="-6" y2="-5"/>
        <line x1="-32" y1="0" x2="-6" y2="-5"/>
        <line x1="-32" y1="0" x2="-6" y2="15"/>
        <line x1="-32" y1="20" x2="-6" y2="15"/>
        <line x1="-32" y1="20" x2="-6" y2="35"/>
        <line x1="6" y1="-25" x2="32" y2="-20"/>
        <line x1="6" y1="-5" x2="32" y2="-20"/>
        <line x1="6" y1="-5" x2="32" y2="0"/>
        <line x1="6" y1="15" x2="32" y2="0"/>
        <line x1="6" y1="15" x2="32" y2="20"/>
        <line x1="6" y1="35" x2="32" y2="20"/>
      </g>
    </g>
    
    <text x="0" y="65" text-anchor="middle" font-family="Georgia, serif" font-size="12" fill="white">s<tspan baseline-shift="sub" font-size="9">Œ∏</tspan>(xÃÉ, œÉ)</text>
  </g>
  
  <!-- Arrow 3 -->
  <line x1="640" y1="220" x2="700" y2="220" stroke="#feca57" stroke-width="2" marker-end="url(#arrowFlow)"/>
  
  <!-- Step 4: Compute Loss -->
  <g transform="translate(800, 220)">
    <rect x="-80" y="-80" width="160" height="160" rx="12" fill="rgba(67,233,123,0.15)" stroke="url(#lossGrad)" stroke-width="2"/>
    
    <text x="0" y="-55" text-anchor="middle" font-family="system-ui" font-size="11" font-weight="600" fill="#43e97b">STEP 4</text>
    <text x="0" y="-38" text-anchor="middle" font-family="system-ui" font-size="10" fill="rgba(255,255,255,0.6)">Compute Loss</text>
    
    <!-- Loss equation -->
    <rect x="-65" y="-20" width="130" height="45" rx="6" fill="rgba(67,233,123,0.2)"/>
    <text x="0" y="10" text-anchor="middle" font-family="Georgia, serif" font-size="14" fill="#43e97b">
      ||s<tspan baseline-shift="sub" font-size="10">Œ∏</tspan> + Œµ/œÉ||¬≤
    </text>
    
    <text x="0" y="50" text-anchor="middle" font-family="system-ui" font-size="10" fill="rgba(255,255,255,0.6)">Target: ‚àíŒµ/œÉ</text>
    <text x="0" y="68" text-anchor="middle" font-family="system-ui" font-size="9" fill="#feca57">Known analytically!</text>
  </g>
  
  <!-- Arrow 4: Backprop -->
  <g transform="translate(920, 220)">
    <path d="M 0,-60 Q 60,-60 60,0 Q 60,60 0,60" fill="none" stroke="#f093fb" stroke-width="2" stroke-dasharray="5,3"/>
    <text x="80" y="5" text-anchor="middle" font-family="system-ui" font-size="10" fill="#f093fb">Backprop</text>
    <polygon points="0,60 10,55 10,65" fill="#f093fb"/>
  </g>
  
  <!-- Bottom: Key formula -->
  <g transform="translate(550, 400)">
    <rect x="-450" y="-30" width="900" height="55" rx="10" fill="rgba(0,0,0,0.4)" stroke="rgba(67,233,123,0.4)" stroke-width="1"/>
    
    <text x="0" y="-5" text-anchor="middle" font-family="Georgia, serif" font-size="16" fill="white">
      L<tspan baseline-shift="sub" font-size="11">DSM</tspan> = E<tspan baseline-shift="sub" font-size="11">x,Œµ</tspan>[ || s<tspan baseline-shift="sub" font-size="11">Œ∏</tspan>(x + œÉŒµ, œÉ) + Œµ/œÉ ||¬≤ ]
    </text>
    <text x="0" y="18" text-anchor="middle" font-family="system-ui" font-size="11" fill="rgba(255,255,255,0.6)">
      Simple MSE loss with known target ‚Ä¢ O(1) cost per sample ‚Ä¢ Powers all modern diffusion models
    </text>
  </g>
</svg>

