<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 480">
  <defs>
    <linearGradient id="bgGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#0f0720"/>
      <stop offset="100%" style="stop-color:#1a0a30"/>
    </linearGradient>
    
    <linearGradient id="qGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#ef4444"/>
      <stop offset="100%" style="stop-color:#f87171"/>
    </linearGradient>
    
    <linearGradient id="kGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#3b82f6"/>
      <stop offset="100%" style="stop-color:#60a5fa"/>
    </linearGradient>
    
    <linearGradient id="vGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#10b981"/>
      <stop offset="100%" style="stop-color:#34d399"/>
    </linearGradient>
    
    <linearGradient id="attnGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f59e0b"/>
      <stop offset="100%" style="stop-color:#fbbf24"/>
    </linearGradient>
    
    <filter id="glow">
      <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    
    <marker id="arrowRed" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#f87171"/>
    </marker>
    
    <marker id="arrowBlue" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#60a5fa"/>
    </marker>
    
    <marker id="arrowGreen" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#34d399"/>
    </marker>
    
    <marker id="arrowYellow" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#fbbf24"/>
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="900" height="480" fill="url(#bgGrad)"/>
  
  <!-- Title -->
  <text x="450" y="40" text-anchor="middle" font-family="system-ui" font-size="26" font-weight="700" fill="white" filter="url(#glow)">
    Self-Attention Block
  </text>
  <text x="450" y="65" text-anchor="middle" font-family="system-ui" font-size="12" fill="rgba(255,255,255,0.6)">
    Global spatial reasoning at 64×64 resolution — Query, Key, Value mechanism
  </text>
  
  <!-- Main Attention Flow -->
  <g transform="translate(80, 90)">
    
    <!-- Input -->
    <g transform="translate(0, 120)">
      <rect x="-30" y="-40" width="60" height="80" rx="8" fill="rgba(168,85,247,0.2)" stroke="#a855f7" stroke-width="2"/>
      <text x="0" y="5" text-anchor="middle" font-family="monospace" font-size="14" font-weight="600" fill="#d8b4fe">x</text>
      <text x="0" y="60" text-anchor="middle" font-family="system-ui" font-size="10" fill="rgba(255,255,255,0.5)">[B,C,H,W]</text>
    </g>
    
    <!-- GroupNorm -->
    <g transform="translate(80, 120)">
      <rect width="70" height="40" rx="6" fill="rgba(6,182,212,0.2)" stroke="#06b6d4" stroke-width="1.5"/>
      <text x="35" y="25" text-anchor="middle" font-family="system-ui" font-size="10" font-weight="600" fill="#67e8f9">GroupNorm</text>
    </g>
    
    <path d="M 40,120 L 70,120" stroke="#a855f7" stroke-width="2"/>
    
    <!-- Split into Q, K, V -->
    <g transform="translate(180, 30)">
      <!-- Q projection -->
      <g transform="translate(0, 0)">
        <rect width="70" height="50" rx="6" fill="rgba(239,68,68,0.2)" stroke="url(#qGrad)" stroke-width="2"/>
        <text x="35" y="20" text-anchor="middle" font-family="system-ui" font-size="11" font-weight="600" fill="#fca5a5">W_Q</text>
        <text x="35" y="38" text-anchor="middle" font-family="monospace" font-size="9" fill="rgba(255,255,255,0.5)">Query</text>
      </g>
      
      <!-- K projection -->
      <g transform="translate(0, 70)">
        <rect width="70" height="50" rx="6" fill="rgba(59,130,246,0.2)" stroke="url(#kGrad)" stroke-width="2"/>
        <text x="35" y="20" text-anchor="middle" font-family="system-ui" font-size="11" font-weight="600" fill="#93c5fd">W_K</text>
        <text x="35" y="38" text-anchor="middle" font-family="monospace" font-size="9" fill="rgba(255,255,255,0.5)">Key</text>
      </g>
      
      <!-- V projection -->
      <g transform="translate(0, 140)">
        <rect width="70" height="50" rx="6" fill="rgba(16,185,129,0.2)" stroke="url(#vGrad)" stroke-width="2"/>
        <text x="35" y="20" text-anchor="middle" font-family="system-ui" font-size="11" font-weight="600" fill="#6ee7b7">W_V</text>
        <text x="35" y="38" text-anchor="middle" font-family="monospace" font-size="9" fill="rgba(255,255,255,0.5)">Value</text>
      </g>
      
      <!-- Arrows from norm to projections -->
      <path d="M -20,90 L -30,90 L -30,25 L -10,25" stroke="#f87171" stroke-width="1.5" fill="none" marker-end="url(#arrowRed)"/>
      <path d="M -20,90 L -10,95" stroke="#60a5fa" stroke-width="1.5" fill="none" marker-end="url(#arrowBlue)"/>
      <path d="M -20,90 L -30,90 L -30,165 L -10,165" stroke="#34d399" stroke-width="1.5" fill="none" marker-end="url(#arrowGreen)"/>
    </g>
    
    <!-- QK^T / sqrt(d) -->
    <g transform="translate(310, 60)">
      <rect width="100" height="60" rx="8" fill="rgba(245,158,11,0.15)" stroke="url(#attnGrad)" stroke-width="2"/>
      <text x="50" y="25" text-anchor="middle" font-family="serif" font-size="14" fill="#fcd34d">QK^T</text>
      <text x="50" y="45" text-anchor="middle" font-family="serif" font-size="12" fill="rgba(255,255,255,0.6)">/ √d</text>
    </g>
    
    <!-- Arrows to QKT -->
    <path d="M 260,55 L 300,70" stroke="#f87171" stroke-width="1.5" marker-end="url(#arrowRed)"/>
    <path d="M 260,125 L 300,100" stroke="#60a5fa" stroke-width="1.5" marker-end="url(#arrowBlue)"/>
    
    <!-- Softmax -->
    <g transform="translate(440, 60)">
      <rect width="80" height="60" rx="8" fill="rgba(168,85,247,0.2)" stroke="#a855f7" stroke-width="2"/>
      <text x="40" y="35" text-anchor="middle" font-family="system-ui" font-size="11" font-weight="600" fill="#d8b4fe">Softmax</text>
    </g>
    
    <path d="M 420,90 L 430,90" stroke="#fbbf24" stroke-width="2" marker-end="url(#arrowYellow)"/>
    
    <!-- Attention × V -->
    <g transform="translate(560, 100)">
      <circle r="25" fill="rgba(16,185,129,0.2)" stroke="#10b981" stroke-width="2"/>
      <text x="0" y="6" text-anchor="middle" font-family="system-ui" font-size="18" fill="#6ee7b7">×</text>
    </g>
    
    <!-- Arrow from softmax to multiply -->
    <path d="M 530,90 L 525,100" stroke="#a855f7" stroke-width="2"/>
    
    <!-- Arrow from V to multiply -->
    <path d="M 260,195 L 350,195 L 350,140 L 525,140 L 525,100" stroke="#34d399" stroke-width="1.5" fill="none" marker-end="url(#arrowGreen)"/>
    
    <!-- Output projection -->
    <g transform="translate(620, 85)">
      <rect width="70" height="50" rx="6" fill="rgba(168,85,247,0.2)" stroke="#a855f7" stroke-width="2"/>
      <text x="35" y="20" text-anchor="middle" font-family="system-ui" font-size="11" font-weight="600" fill="#d8b4fe">W_O</text>
      <text x="35" y="38" text-anchor="middle" font-family="monospace" font-size="9" fill="rgba(255,255,255,0.5)">Proj out</text>
    </g>
    
    <path d="M 595,100 L 610,110" stroke="#10b981" stroke-width="2"/>
    
    <!-- Addition with residual -->
    <g transform="translate(730, 110)">
      <circle r="20" fill="rgba(16,185,129,0.2)" stroke="#10b981" stroke-width="2"/>
      <text x="0" y="6" text-anchor="middle" font-family="system-ui" font-size="18" fill="#6ee7b7">+</text>
    </g>
    
    <path d="M 700,110 L 700,110" stroke="#a855f7" stroke-width="2"/>
    
    <!-- Skip connection from input -->
    <path d="M 0,60 L 0,20 L 730,20 L 730,80" stroke="#a855f7" stroke-width="2" fill="none" stroke-dasharray="6,3"/>
    
    <!-- Output -->
    <g transform="translate(770, 120)">
      <rect x="-20" y="-30" width="50" height="60" rx="8" fill="rgba(16,185,129,0.2)" stroke="#10b981" stroke-width="2"/>
      <text x="5" y="5" text-anchor="middle" font-family="monospace" font-size="14" font-weight="600" fill="#6ee7b7">h</text>
    </g>
    
    <path d="M 758,110 L 740,110" stroke="#10b981" stroke-width="2"/>
  </g>
  
  <!-- Formula -->
  <g transform="translate(100, 360)">
    <rect width="700" height="100" rx="12" fill="rgba(0,0,0,0.4)" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
    <text x="350" y="30" text-anchor="middle" font-family="system-ui" font-size="14" font-weight="600" fill="white">Self-Attention Formula</text>
    <text x="350" y="60" text-anchor="middle" font-family="serif" font-size="18" fill="white">
      Attention(Q, K, V) = softmax(QK^T / √d_k) · V
    </text>
    <text x="350" y="85" text-anchor="middle" font-family="system-ui" font-size="11" fill="rgba(255,255,255,0.5)">
      where Q = W_Q·x, K = W_K·x, V = W_V·x — all derived from the same input
    </text>
  </g>
</svg>

