<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 850 450">
  <defs>
    <linearGradient id="reparamBg" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#0f2027"/>
      <stop offset="50%" style="stop-color:#203a43"/>
      <stop offset="100%" style="stop-color:#2c5364"/>
    </linearGradient>
    <linearGradient id="blockGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#ff416c"/>
      <stop offset="100%" style="stop-color:#ff4b2b"/>
    </linearGradient>
    <linearGradient id="flowGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#11998e"/>
      <stop offset="100%" style="stop-color:#38ef7d"/>
    </linearGradient>
    <marker id="gradArrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <path d="M0,0 L0,6 L9,3 z" fill="#38ef7d"/>
    </marker>
    <marker id="blockArrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <path d="M0,0 L0,6 L9,3 z" fill="#ff4b2b"/>
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="850" height="450" fill="url(#reparamBg)" rx="15"/>
  
  <!-- Title -->
  <text x="425" y="35" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="24" font-weight="bold">The Reparameterization Trick</text>
  
  <!-- Problem: Without reparam -->
  <g transform="translate(50, 70)">
    <rect x="0" y="0" width="350" height="160" rx="10" fill="#1a1a2e" stroke="#ff416c" stroke-width="2"/>
    <text x="175" y="25" text-anchor="middle" fill="#ff416c" font-size="16" font-weight="bold">❌ Problem: Direct Sampling</text>
    
    <!-- Flow diagram -->
    <rect x="30" y="50" width="60" height="40" rx="5" fill="#2d3436"/>
    <text x="60" y="75" text-anchor="middle" fill="#ffffff" font-size="12">φ</text>
    
    <path d="M 95 70 L 120 70" stroke="#ffffff" stroke-width="2"/>
    
    <rect x="125" y="50" width="80" height="40" rx="5" fill="#2d3436"/>
    <text x="165" y="75" text-anchor="middle" fill="#ffffff" font-size="11">q_φ(z|x)</text>
    
    <path d="M 210 70 L 235 70" stroke="#ffffff" stroke-width="2"/>
    
    <!-- Sampling node with X -->
    <circle cx="260" cy="70" r="20" fill="url(#blockGrad)"/>
    <text x="260" y="76" text-anchor="middle" fill="#ffffff" font-size="14" font-weight="bold">z~</text>
    
    <path d="M 285 70 L 310 70" stroke="#ffffff" stroke-width="2" stroke-dasharray="5,3"/>
    
    <rect x="315" y="50" width="60" height="40" rx="5" fill="#2d3436" opacity="0.5"/>
    <text x="345" y="75" text-anchor="middle" fill="#aaaaaa" font-size="12">f(z)</text>
    
    <!-- Blocked gradient -->
    <path d="M 315 120 L 100 120" stroke="#ff4b2b" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#blockArrow)"/>
    <text x="210" y="140" text-anchor="middle" fill="#ff4b2b" font-size="11">∇_φ blocked! Cannot backprop through sampling</text>
  </g>
  
  <!-- Solution: With reparam -->
  <g transform="translate(450, 70)">
    <rect x="0" y="0" width="350" height="160" rx="10" fill="#1a1a2e" stroke="#38ef7d" stroke-width="2"/>
    <text x="175" y="25" text-anchor="middle" fill="#38ef7d" font-size="16" font-weight="bold">✓ Solution: Reparameterization</text>
    
    <!-- Epsilon (external randomness) -->
    <circle cx="60" cy="70" r="20" fill="#ffe66d"/>
    <text x="60" y="76" text-anchor="middle" fill="#000000" font-size="14">ε</text>
    <text x="60" y="105" text-anchor="middle" fill="#aaaaaa" font-size="9">ε ~ N(0,I)</text>
    
    <!-- Parameters -->
    <rect x="30" y="115" width="60" height="30" rx="5" fill="#2d3436"/>
    <text x="60" y="135" text-anchor="middle" fill="#ffffff" font-size="11">μ_φ, σ_φ</text>
    
    <!-- Deterministic transform -->
    <path d="M 85 70 L 130 70" stroke="#ffffff" stroke-width="2"/>
    <path d="M 95 130 L 130 90" stroke="#ffffff" stroke-width="2"/>
    
    <rect x="135" y="55" width="90" height="50" rx="5" fill="#38ef7d" opacity="0.3" stroke="#38ef7d" stroke-width="2"/>
    <text x="180" y="78" text-anchor="middle" fill="#ffffff" font-size="11">z = μ + σ⊙ε</text>
    <text x="180" y="95" text-anchor="middle" fill="#38ef7d" font-size="9">deterministic!</text>
    
    <path d="M 230 80 L 270 80" stroke="#ffffff" stroke-width="2"/>
    
    <rect x="275" y="60" width="50" height="40" rx="5" fill="#2d3436"/>
    <text x="300" y="85" text-anchor="middle" fill="#ffffff" font-size="12">f(z)</text>
    
    <!-- Gradient flows! -->
    <path d="M 270 130 L 100 130" stroke="#38ef7d" stroke-width="2" marker-end="url(#gradArrow)"/>
    <text x="185" y="148" text-anchor="middle" fill="#38ef7d" font-size="11">∇_φ flows through μ and σ ✓</text>
  </g>
  
  <!-- Mathematical explanation -->
  <g transform="translate(100, 260)">
    <rect x="0" y="0" width="650" height="170" rx="10" fill="#0d1b2a" stroke="#4facfe" stroke-width="2"/>
    <text x="325" y="25" text-anchor="middle" fill="#4facfe" font-size="16" font-weight="bold">Key Insight</text>
    
    <!-- Before -->
    <g transform="translate(30, 45)">
      <text x="0" y="0" fill="#ff416c" font-size="13" font-weight="bold">Before:</text>
      <text x="0" y="25" fill="#ffffff" font-size="12">∇_φ E_{z~q_φ}[f(z)] = ??? (sampling blocks gradient)</text>
    </g>
    
    <!-- After -->
    <g transform="translate(30, 95)">
      <text x="0" y="0" fill="#38ef7d" font-size="13" font-weight="bold">After:</text>
      <text x="0" y="25" fill="#ffffff" font-size="12">∇_φ E_{ε~N(0,I)}[f(μ_φ + σ_φ ⊙ ε)] = E_ε[∇_φ f(μ_φ + σ_φ ⊙ ε)]</text>
      <text x="350" y="50" fill="#38ef7d" font-size="11">↑ Monte Carlo estimable with 1 sample!</text>
    </g>
  </g>
</svg>


